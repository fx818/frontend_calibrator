<!doctype html>
<html lang="en">

<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Certificate Approval Dashboard</title>
Â  <style>
Â  Â  :root {
Â  Â  Â  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
Â  Â  Â  line-height: 1.5;
Â  Â  Â  font-weight: 400;
Â  Â  Â  color-scheme: light dark;
Â  Â  Â  color: rgba(255, 255, 255, 0.87);
Â  Â  Â  background-color: #242424;
Â  Â  Â  --primary-color: #646cff;
Â  Â  Â  --success-color: #22c55e;
Â  Â  Â  --danger-color: #ef4444;
Â  Â  Â  --warning-color: #f59e0b;
Â  Â  Â  --bg-secondary: #2d2d2d;
Â  Â  Â  --bg-card: #333;
Â  Â  Â  --border-color: #404040;
Â  Â  Â  --text-primary: rgba(255, 255, 255, 0.87);
Â  Â  }

Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
Â  Â  }

Â  Â  #app {
Â  Â  Â  min-height: 100vh;
Â  Â  }

Â  Â  .dashboard {
Â  Â  Â  min-height: 100vh;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }

Â  Â  .dashboard-header {
Â  Â  Â  background: var(--bg-secondary);
Â  Â  Â  padding: 1.5rem 2rem;
Â  Â  Â  border-bottom: 1px solid var(--border-color);
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  .dashboard-header h1 {
Â  Â  Â  margin: 0;
Â  Â  Â  font-size: 2rem;
Â  Â  Â  background: linear-gradient(135deg, var(--primary-color), #7c3aed);
Â  Â  Â  -webkit-background-clip: text;
Â  Â  Â  -webkit-text-fill-color: transparent;
Â  Â  }

Â  Â  .api-status {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 0.5rem;
Â  Â  Â  padding: 0.5rem 1rem;
Â  Â  Â  background: var(--bg-card);
Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  }

Â  Â  .status-indicator {
Â  Â  Â  width: 8px;
Â  Â  Â  height: 8px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  display: inline-block;
Â  Â  }

Â  Â  .status-indicator.online {
Â  Â  Â  background: var(--success-color);
Â  Â  Â  box-shadow: 0 0 6px var(--success-color);
Â  Â  }

Â  Â  .status-indicator.offline {
Â  Â  Â  background: var(--danger-color);
Â  Â  Â  box-shadow: 0 0 6px var(--danger-color);
Â  Â  }

Â  Â  .status-indicator.checking {
Â  Â  Â  background: var(--warning-color);
Â  Â  Â  animation: pulse 2s infinite;
Â  Â  }

Â  Â  @keyframes pulse {

Â  Â  Â  0%,
Â  Â  Â  100% {
Â  Â  Â  Â  opacity: 1;
Â  Â  Â  }

Â  Â  Â  50% {
Â  Â  Â  Â  opacity: 0.5;
Â  Â  Â  }
Â  Â  }

Â  Â  .dashboard-main {
Â  Â  Â  flex: 1;
Â  Â  Â  padding: 2rem;
Â  Â  Â  max-width: 1200px;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  width: 100%;
Â  Â  }

Â  Â  .btn {
Â  Â  Â  padding: 0.75rem 1.5rem;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .btn-primary {
Â  Â  Â  background: linear-gradient(135deg, var(--primary-color), #7c3aed);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .btn-success {
Â  Â  Â  background: linear-gradient(135deg, var(--success-color), #16a34a);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .btn-danger {
Â  Â  Â  background: linear-gradient(135deg, var(--danger-color), #dc2626);
Â  Â  Â  color: white;
Â  Â  }

Â  Â  .info-card,
Â  Â  .certificate-card,
Â  Â  .approval-card,
Â  Â  .response-card {
Â  Â  Â  background: var(--bg-card);
Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  border-radius: 0.75rem;
Â  Â  Â  padding: 1.5rem;
Â  Â  Â  margin-bottom: 1rem;
Â  Â  }

Â  Â  .certificates-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
Â  Â  Â  gap: 1rem;
Â  Â  }

Â  Â  .certificate-details p {
Â  Â  Â  margin: 0.25rem 0;
Â  Â  Â  font-size: 0.9rem;
Â  Â  }

Â  Â  .status-badge.pending {
Â  Â  Â  background: rgba(245, 158, 11, 0.2);
Â  Â  Â  color: var(--warning-color);
Â  Â  Â  border: 1px solid var(--warning-color);
Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  border-radius: 1rem;
Â  Â  }

Â  Â  .status-badge.approved {
Â  Â  Â  background: rgba(34, 197, 94, 0.2);
Â  Â  Â  color: var(--success-color);
Â  Â  Â  border: 1px solid var(--success-color);
Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  border-radius: 1rem;
Â  Â  }

Â  Â  .status-badge.rejected {
Â  Â  Â  background: rgba(239, 68, 68, 0.2);
Â  Â  Â  color: var(--danger-color);
Â  Â  Â  border: 1px solid var(--danger-color);
Â  Â  Â  padding: 0.25rem 0.75rem;
Â  Â  Â  border-radius: 1rem;
Â  Â  }

Â  Â  .toast {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 2rem;
Â  Â  Â  right: 2rem;
Â  Â  Â  background: var(--bg-card);
Â  Â  Â  color: var(--text-primary);
Â  Â  Â  padding: 1rem;
Â  Â  Â  border-radius: 0.5rem;
Â  Â  Â  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
Â  Â  Â  transform: translateX(400px);
Â  Â  Â  transition: transform 0.3s ease;
Â  Â  }

Â  Â  .toast.show {
Â  Â  Â  transform: translateX(0);
Â  Â  }

Â  Â  .loading-overlay {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.8);
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  }

Â  Â  .spinner {
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  border: 4px solid rgba(100, 108, 255, 0.3);
Â  Â  Â  border-top: 4px solid var(--primary-color);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  }

Â  Â  @keyframes spin {
Â  Â  Â  0% {
Â  Â  Â  Â  transform: rotate(0deg);
Â  Â  Â  }

Â  Â  Â  100% {
Â  Â  Â  Â  transform: rotate(360deg);
Â  Â  Â  }
Â  Â  }
Â  </style>
</head>

<body>
Â  <div id="app"></div>

Â  <script>
Â  Â  class CertificateDashboard {
Â  Â  Â  constructor() {
Â  Â  Â  Â  this.apiBaseUrl = 'https://calibration.prossimatech.com';
Â  Â  Â  Â  this.certificates = [];
Â  Â  Â  Â  this.isLoading = false;
Â  Â  Â  Â  this.init();
Â  Â  Â  }
Â  Â  Â  init() { this.renderDashboard(); this.checkApiHealth(); this.bindEvents(); }
Â  Â  Â  renderDashboard() {
Â  Â  Â  Â  const app = document.getElementById('app');
Â  Â  Â  Â  app.innerHTML = `
Â  Â  Â  Â  Â  <div class="dashboard">
Â  Â  Â  Â  Â  Â  <header class="dashboard-header">
Â  Â  Â  Â  Â  Â  Â  <h1>Certificate Approval Dashboard</h1>
Â  Â  Â  Â  Â  Â  Â  <div class="api-status" id="apiStatus">
Â  Â  Â  Â  Â  Â  Â  Â  <span class="status-indicator checking"></span>
Â  Â  Â  Â  Â  Â  Â  Â  <span>Checking API...</span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </header>
Â  Â  Â  Â  Â  Â  <main class="dashboard-main">
Â  Â  Â  Â  Â  Â  Â  <div class="action-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="extractBtn" class="btn btn-primary">ğŸ“Š Extract Certificates</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="results-section" id="resultsSection" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="certificate-list" id="certificateList"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="approval-panel" id="approvalPanel" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="approval-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>âš ï¸ Approval Required</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Do you approve pushing these certificates to calendar?</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="approveBtn" class="btn btn-success">âœ… Approve</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="rejectBtn" class="btn btn-danger">âŒ Reject</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="response-section" id="responseSection" style="display:none;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="response-card">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3>API Response</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <pre id="responseContent"></pre>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </main>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="toast" id="toast"></div>
Â  Â  Â  Â  Â  <div class="loading-overlay" id="loadingOverlay" style="display:none;">
Â  Â  Â  Â  Â  Â  <div class="spinner"></div>
Â  Â  Â  Â  Â  Â  <p>Processing...</p>
Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  }
Â  Â  Â  bindEvents() {
Â  Â  Â  Â  document.addEventListener('click', e => {
Â  Â  Â  Â  Â  if (e.target.closest('#extractBtn')) this.extractCertificates();
Â  Â  Â  Â  Â  if (e.target.closest('#approveBtn')) this.sendApproval('yes');
Â  Â  Â  Â  Â  if (e.target.closest('#rejectBtn')) this.sendApproval('no');
Â  Â  Â  Â  Â  if (e.target.closest('.finalize-btn')) {
Â  Â  Â  Â  Â  Â  const certNumber = e.target.dataset.cert;
Â  Â  Â  Â  Â  Â  this.finalizeApproval(certNumber);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  async checkApiHealth() {
Â  Â  Â  Â  const statusElement = document.getElementById('apiStatus');
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(`${this.apiBaseUrl}/`);
Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  if (response.ok && data.status === 'API is running') {
Â  Â  Â  Â  Â  Â  statusElement.innerHTML = `<span class="status-indicator online"></span><span>API Connected</span>`;
Â  Â  Â  Â  Â  } else throw new Error('API health check failed');
Â  Â  Â  Â  } catch {
Â  Â  Â  Â  Â  statusElement.innerHTML = `<span class="status-indicator offline"></span><span>API Offline</span>`;
Â  Â  Â  Â  Â  this.showToast('Failed to connect to API', 'error');
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  async extractCertificates() {
Â  Â  Â  Â  this.setLoading(true);
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(`${this.apiBaseUrl}/extract_certificates`, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  Â  credentials: "include",
Â  Â  Â  Â  Â  Â  // The API endpoint no longer requires a request body.
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  if (response.ok) this.handleExtractResponse(data);
Â  Â  Â  Â  Â  else throw new Error(data.message || "Failed to extract");
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  this.showToast(`Error: ${error.message}`, 'error');
Â  Â  Â  Â  } finally { this.setLoading(false); }
Â  Â  Â  }

Â  Â  Â  handleExtractResponse(data) {
Â  Â  Â  Â  const resultsSection = document.getElementById('resultsSection');
Â  Â  Â  Â  const certificateList = document.getElementById('certificateList');
Â  Â  Â  Â  const approvalPanel = document.getElementById('approvalPanel');
Â  Â  Â  Â  const responseSection = document.getElementById('responseSection');
Â  Â  Â  Â  const responseContent = document.getElementById('responseContent');
Â  Â  Â  Â  // Add this line to store the certificates array from the API response.
Â  Â  Â  Â  this.certificates = data.raw_certs || [];
Â  Â  Â  Â  resultsSection.style.display = 'block';
Â  Â  Â  Â  if (this.certificates.length > 0) this.renderCertificates(this.certificates);
Â  Â  Â  Â  else {
Â  Â  Â  Â  Â  certificateList.innerHTML = `<div class="info-card"><h3>ğŸ“‹ Extraction Result</h3><p><strong>Status:</strong> ${data.status}</p><p><strong>Message:</strong> ${data.message}</p></div>`;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (data.status === 'Waiting') approvalPanel.style.display = 'block';
Â  Â  Â  Â  responseSection.style.display = 'block';
Â  Â  Â  Â  responseContent.textContent = JSON.stringify(data, null, 2);
Â  Â  Â  }
Â  Â  Â  renderCertificates(certificates) {
Â  Â  Â  Â  const certificateList = document.getElementById('certificateList');
Â  Â  Â  Â  const cards = certificates.map((cert, i) => {
Â  Â  Â  Â  Â  const certStatus = cert.status || "pending";
Â  Â  Â  Â  Â  return `
Â  Â  Â  Â  Â  Â  <div class="certificate-card">
Â  Â  Â  Â  Â  Â  Â  <div class="certificate-header" style="display:flex;justify-content:space-between;align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <h4>Certificate #${i + 1}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="status-badge ${certStatus}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  ${certStatus.charAt(0).toUpperCase() + certStatus.slice(1)}
Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="certificate-details">
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Certificate Number:</strong> ${cert.certificate_number || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Issue Date:</strong> ${cert.issue_date || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Calibration Next Due:</strong> ${cert.calibration_next_due || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Customer Name:</strong> ${cert.customer_name || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Customer Address:</strong> ${cert.customer_address || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>DUC ID:</strong> ${cert.duc_id || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>DUC Make/Model:</strong> ${cert.duc_make_model || "N/A"}</p>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  }).join('');
Â  Â  Â  Â  certificateList.innerHTML = `<div class="certificates-header"><h3>ğŸ“‹ Extracted Certificates (${certificates.length})</h3></div><div class="certificates-grid">${cards}</div>`;
Â  Â  Â  }
Â  Â  Â  async sendApproval(decision) {
Â  Â  Â  Â  this.setLoading(true);
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(`${this.apiBaseUrl}/approval?user_input=${decision}`, { method: 'POST' });
Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  this.handleApprovalResponse(data, decision);
Â  Â  Â  Â  Â  Â  this.showToast(data.message, 'success');
Â  Â  Â  Â  Â  } else throw new Error(data.message || 'Failed approval');
Â  Â  Â  Â  } catch (e) { this.showToast(`Error: ${e.message}`, 'error'); }
Â  Â  Â  Â  finally { this.setLoading(false); }
Â  Â  Â  }
Â  Â  Â  async finalizeApproval(certNumber) {
Â  Â  Â  Â  this.setLoading(true);
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(`${this.apiBaseUrl}/approval?certificate_number=${certNumber}`, { method: 'POST' });
Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  this.showToast(`Certificate ${certNumber} finalized`, 'success');
Â  Â  Â  Â  Â  Â  this.updateCertificateStatus('finalized');
Â  Â  Â  Â  Â  } else throw new Error(data.message);
Â  Â  Â  Â  } catch (e) { this.showToast(`Error: ${e.message}`, 'error'); }
Â  Â  Â  Â  finally { this.setLoading(false); }
Â  Â  Â  }
Â  Â  Â  handleApprovalResponse(data, decision) {
Â  Â  Â  Â  document.getElementById('approvalPanel').style.display = 'none';
Â  Â  Â  Â  this.updateCertificateStatus(decision === 'yes' ? 'approved' : 'rejected');
Â  Â  Â  Â  document.getElementById('responseContent').textContent = JSON.stringify(data, null, 2);
Â  Â  Â  }
Â  Â  Â  updateCertificateStatus(status) {
Â  Â  Â  Â  document.querySelectorAll('.status-badge').forEach(badge => {
Â  Â  Â  Â  Â  badge.className = `status-badge ${status}`;
Â  Â  Â  Â  Â  badge.textContent = status.charAt(0).toUpperCase() + status.slice(1);
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  setLoading(l) {
Â  Â  Â  Â  this.isLoading = l;
Â  Â  Â  Â  document.getElementById('loadingOverlay').style.display = l ? 'flex' : 'none';
Â  Â  Â  Â  const btn = document.getElementById('extractBtn'); if (btn) btn.disabled = l;
Â  Â  Â  }
Â  Â  Â  showToast(msg, type = 'info') {
Â  Â  Â  Â  const toast = document.getElementById('toast');
Â  Â  Â  Â  toast.className = `toast ${type} show`;
Â  Â  Â  Â  toast.textContent = msg;
Â  Â  Â  Â  setTimeout(() => { toast.className = 'toast'; }, 4000);
Â  Â  Â  }
Â  Â  }
Â  Â  document.addEventListener('DOMContentLoaded', () => new CertificateDashboard());
Â  </script>
</body>

</html>
